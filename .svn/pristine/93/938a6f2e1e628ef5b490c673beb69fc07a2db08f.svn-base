import React from 'react';
import { connect } from 'dva';
import { Modal, Card, Input, Button, message } from 'antd';
import PageHeaderWrapper from '@/components/PageHeaderWrapper';

import styles from "./MerchShare.less";
import imgUrl from "@/global";

@connect(({ seting, loading }) => ({
  seting,
  loading: loading.models.rule,
}))

class MerchShare extends React.PureComponent {
  constructor(props) {
    super(props);
    this.state = { auth: sessionStorage.getItem('auth') };
    this.copyInput = React.createRef();
  }


  componentDidMount() {
    const { auth } = this.state;
    const { dispatch } = this.props;
    if (auth === "agent") {
      dispatch({
        type: 'seting/fetch',
      });
    }

  }

  copy = () => {
    this.copyInput.current.input.select();
    document.execCommand("Copy"); // 执行浏览器复制命令
    message.success('复制成功,快去邀请吧~');
  }

  render() {
    const { auth } = this.state;
    const { seting } = this.props;
    const url = imgUrl + seting.invitationCode.data.url;
    const { qrUrl, code } = seting.invitationCode.data;
    return (
      <PageHeaderWrapper title="分享注册">
        {/* <Button type="primary" onClick={this.showModal}>
            商户分享
        </Button> */}
        {auth === 'agent' &&
          <Card className="textCenter">
            <h2>分享注册</h2>
            <img src={url} alt="二维码" className={styles.qrCode} />
            <p className={styles.inviteInfo}>邀请码: <strong style={{ fontSize: 20,color:'red' }}>{code}</strong></p>
            <p className={styles.inviteInfo}>分享链接: <Input style={{ width: 350 }} value={qrUrl} ref={this.copyInput} /> <Button onClick={this.copy}>复制</Button></p>
          </Card>
        }


      </PageHeaderWrapper>)
  }
}


MerchShare.defaultProps = {
  seting: {
    invitationCode: {
      url: '',
      qrUrl: '',
      code: ''
    }
  }
};
export default MerchShare;